###----------------------------------------------------------------###
                                                         2017/10/26
TeraTerm用コマンド自動実行マクロ
『command_exec』Ver1.20

                                         copyright (c) 2017 N.Inoue


 E-Mail: mailto:gx3n-inue@asahi-net.or.jp
 Web   : http://www.asahi-net.or.jp/~gx3n-inue/apps/command_exec/

###----------------------------------------------------------------###

≪著作権および免責事項≫

　本ソフトはフリーソフトです。自由にご使用ください。なお，著作権は作者
である 井上 信之 が保有しています。

　このソフトウェアを使用したことによって生じたすべての障害・損害・不具
合等に関しては、私と私の関係者および私の所属するいかなる団体・組織とも、
一切の責任を負いません。各自の責任においてご使用ください。


インデックス
  ■使用用途・使用目的・使用方法
  ■種別
  ■動作環境
  ■免責
  ■バージョン履歴
  ■開発環境・謝辞

###----------------------------------------------------------------###

■使用用途・目的・使用方法

  Tera Term 用の自動ログインと実行コマンド自動送信用のマクロです。

  「連続版(ver1.20A)」、または、
  「ダイアログで確認しながら逐次版(ver1.20M)」、

  のマクロを起動したあと、

  接続先情報（ホスト名またはIPアドレスおよびポート番号）や
  実行したいコマンドのリストを記述した
  
    コマンドリストファイル
  
  を選択すれば、  自動的にネットワーク機器にログインし、
  コマンドリストファイルに記載されたコマンド群が実行されます。

  ログインした機器のホスト名や接続時刻を元に、
  ログファイルの生成も自動的に行います。
  
  TTPMACRO.EXE のオプション（引数）として、起動させることもできます。
  各引数は以下のように指定します。

    第１引数			ttpmacro.exeコマンド（環境変数PATHにセットしていない場合は、絶対パス）
    第２引数(param1)	command_list_common_ver1.20A(auto).ttl（相対パス可）
    第３引数(param2)	コマンドリストの指定（相対パス可）
    第４引数(param3)	TERATERM用環境設定ファイル(.INI)の指定（省略可）

  起動例）
  C:\>"c:\Program Files\teraterm\ttpmacro.exe" "c:\cmd_exec_ver1.20\command_exec_common_ver1.20A(auto).ttl" "c:\cmd_exec_ver1.20\コマンドリスト\【コマンドリスト】(telnet)_Cisco_Catalyst3560サンプル(Router01)(10.0.0.1).txt" TERATERM.INI
  
  コマンドリストの記述方法は、サンプルを参考にしてください。
  
  行頭が"##"から始まる行は、コメント行として扱われるようになっています。
  "#"が１文字のみの場合は、そのままコマンドとして送信されます。

  ----------------------------
  ☆接続情報の記述
  ----------------------------
  コマンドリストファイルの（コメント行を除く）最初の１行目には、
  接続情報を記述してください。

  書式は以下の通りです。

      IPアドレスまたはホスト名:ポート番号,ユーザー名,パスワード

  telnetでの接続の場合は、２行目以降に、
  返されてくるログインプロンプトに応じて、
  ユーザー名、パスワードを記述してください。

  sshでの接続の場合は、１行目（接続情報行）の中にユーザー名と
  パスワードを記述してください。

  IPアドレスまたはホスト名の部分に、COM[1-9]を指定すると、
  シリアル接続を指定することもできます。
  
  シリアル接続の場合は、ポート番号、ユーザー名、パスワードは
  記述する必要はありません。

  ユーザー名、パスワード等を送信し、ログイン成功直後には、

  必ず空行を１〜２行入れておいてください。
  改行のみを送信することにより、プロンプト文字列を検出しています。


■使用上の注意

  ログファイルは、

    command_exec_common_ver1.20M(manual).ttl

  または

    command_exec_common_ver1.20A(auto).ttl

  が配置されているパスのサブディレクトリ(log)に自動で生成されます。

  サブディレクトリ(log)が存在しない場合は、ログが出力されませんので、
  ご注意ください。

  または、SSHでの接続時には、ログファイル名の
  ホスト名文字列の一部が欠ける場合がありますが、ご容赦ください。



■種別
  フリーソフト


■動作環境
	TeraTerm ver4.67以降


■免責

  ・動作確認には細心の注意を払っていますが、このソフトを使ったことによる
   いかなる損害に対しても作者は責任を負いません。

    ご使用については自己責任の元でお願いします。

  ・オリジナルを私の WEB サイトで配布している関係で、他 WEB サイトへの
    転載はご遠慮ください。


■インストール・アンインストール

  以下のファイルが含まれています。

  readme.txt
                    説明書（お読みになっているファイル）

  command_exec_common_ver1.20M(manual).ttl
                    自動ログイン・自動コマンド送信マクロ（コマンド逐次送信）

  command_exec_common_ver1.20A(auto).ttl
                    自動ログイン・自動コマンド送信マクロ（コマンド自動連続送信）

  [log]フォルダ
                    ログファイルの作成先フォルダ（デフォルト）

  [コマンドリスト]フォルダ
                    コマンドリストファイル・サンプル


  readme.txt をお読みになったあと、

  TTPMACRO.EXE から
  
  command_exec_common_ver1.20M(manual).ttl
  command_exec_common_ver1.20A(auto).ttl
  
  を起動させてください。

  続けて、接続したい機器の接続情報および送信コマンドを記述した
  コマンドリストファイルを選択してください。

  アンインストールは、上記のファイル・フォルダを削除するだけです。


###----------------------------------------------------------------###
■バージョン履歴

ver1.13	(2017/10/03) 
	- コマンド逐次送信版（公開初版）
	
ver1.16 (2017/10/03)
	- コマンド連続自動送信版（公開初版）

ver1.20 (2017/10/26)
	- コマンド連続自動送信版および逐次送信版のバージョンを統一
	- waitln関数にてプロンプトの取得時の仮ホスト名付与処理追加


###----------------------------------------------------------------###

■開発環境・謝辞

  TeraTerm Version 4.95
  サクラエディタ   Ver. 2.2.0.1

■動作確認機器

  Fedora22
  CentOS7
  Ubuntu

  Cisco Catalystシリーズスイッチ
  Cisco各種ルータ
  NEC IP8800シリーズ
  NEC QXシリーズ
  YAMAHA RTXシリーズ
  Foundry FastIron 4800シリーズ
  HP Aruba 2300/2500シリーズ

  上記以外でも、コマンド送信時に改行コードを送信する機種であれば、
  動作は可能です。
  
  コマンド送信時に、改行コードを送信せずに制御コードでカーソルを
  移動している機種では、プロンプト文字列の検出に失敗し、ログファイル
  名に出力されるホスト名が正しくセットされませんが、ご了承ください。


  最後に、日頃からお世話になっている関係者の方々に感謝します。

###----------------------------------------------------------------###
